<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>suitecontroller.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteController.html">SuiteController</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#closeSuite">closeSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#createNewScript">createNewScript</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#export">export</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#getSuiteJson">getSuiteJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#initialize">initialize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#load">load</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#loadSuite">loadSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#newScript">newScript</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#newSuite">newSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#run">run</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#runSuite">runSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#save">save</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#saveSettings">saveSettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#saveSuite">saveSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteController.html#settings">settings</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteController.SuiteController.html">SuiteController</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteModel.html">SuiteModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#getJson">getJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#getScriptModel">getScriptModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#initialize">initialize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#loadJson">loadJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#saveSettings">saveSettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteModel.html#saveSuite">saveSuite</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteModel.SuiteModel.html">SuiteModel</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteView.html">SuiteView</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#addRows">addRows</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#addScriptsTabEntry">addScriptsTabEntry</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#checkIfExists">checkIfExists</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#clearNewScriptDialogFields">clearNewScriptDialogFields</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#clearSettingsFields">clearSettingsFields</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#createNewScriptTab">createNewScriptTab</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#createSheets">createSheets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#displaySettings">displaySettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#displayTab">displayTab</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#doSaveAction">doSaveAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#downloadSuite">downloadSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#getBrowserOptions">getBrowserOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#getScriptsData">getScriptsData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#getUISettingsValues">getUISettingsValues</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#handleCellChange">handleCellChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#handleCellSelection">handleCellSelection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#hideNewScriptDialog">hideNewScriptDialog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#hideSettings">hideSettings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#initialize">initialize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#loadScripts">loadScripts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#populateUISettingsValue">populateUISettingsValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#registerHandlers">registerHandlers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#removeScriptAndTab">removeScriptAndTab</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#sanitizeJson">sanitizeJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#showErrorDialog">showErrorDialog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#showNewScriptDialog">showNewScriptDialog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#showSuiteOverwriteWarning">showSuiteOverwriteWarning</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SuiteView.html#validateSettings">validateSettings</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SuiteView.SuiteView.html">SuiteView</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#actions">actions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#bindKeyboardShortcuts">bindKeyboardShortcuts</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">suitecontroller.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/// ================ SuiteController =========================
/**
 * The Controller Class that interfaces between the model and the UI elements
 *
 * @class SuiteController
 */
class SuiteController {
    /**
     * Creates an instance of SuiteController.
     * @memberof SuiteController
     */
    constructor() {
    }

    /**
     * Initialize the SuiteController with the SuiteView and SuiteModel objects
     *
     * @param {SuiteView} suiteView - The SuiteView Object
     * @param {SuiteModel} suiteModel - The SuiteModel Object
     * @memberof SuiteController
     */
    initialize(suiteView, suiteModel) {
        this.suiteView = suiteView;
        this.suiteModel = suiteModel;
    }

    /**
     * Load the Suite content from a file that was uploaded the server and 
     * returned back as a json object in the html
     *
     * @param {JSON} suiteContent - suite content from file
     * @memberof SuiteController
     */
    loadSuite(suiteContent, showToast) {
        console.log("Suite Model suiteContent")
        this.suiteModel.loadJson(suiteContent);
        this.suiteView.populateUISettingsValue(this.suiteModel.settings);
        this.suiteView.loadScripts(this.suiteModel.scripts);
        if (showToast) {
            toastr.success("Script loaded!");
        }
        sessionStorage.setItem('savedSuite', JSON.stringify(suiteContent));
    }

    /**
     * Save the Suite settings - serverURL, browser settings etc.
     *
     * @param {JSON} settings - settings json
     * @memberof SuiteController
     */
    saveSettings(settings) {
        console.log("Saving settings");
        this.suiteModel.saveSettings(settings)
        console.log(this.suiteModel.settings);
        //toastr.success('Settings saved!')
    }

    /**
     * Creates a new script and also the UI elements
     *
     * @param {String} scriptName - name of the script
     * @param {boolean} run - run the script, if true
     * @param {boolean} stopOnError - stop the script on error, if true
     * @memberof SuiteController
     */
    createNewScript(scriptName, run, stopOnError) {
        this.suiteView.hideNewScriptDialog();
        this.suiteView.createNewScriptTab(scriptName, run, stopOnError);
    }


    /**
     * Save the Suite data including settings and isRun is true, execute the script
     *
     * @param {JSON} sData - Suite Data - script and settings JSON
     * @param {boolean} isRun - Run the script if true
     * @memberof SuiteController
     */
    saveSuite(sData, isRun) {
        let thisController = this;
        let suiteName = this.suiteModel.settings.name;
        console.log("Before Ajax: ", suiteName);
        this.suiteModel.saveSuite(sData);
        const modelData = this.suiteModel.getJson();
        sessionStorage.setItem('savedSuite', JSON.stringify(modelData));
        console.log("Making Ajax Request", modelData);
        $.ajax({
            'type': 'POST',
            'url': '/save',
            'data': JSON.stringify(modelData),
            'success': function (data) {
                console.log("Server Response: ", data);
                if (data.status === 0) {
                    toastr.success('Validation Successful, Suite Saved!');
                    thisController.suiteView.clearErrorDialog();
                    if (isRun) {
                        console.log("running: " + suiteName)
                        thisController.runSuite(suiteName);
                    }
                }
                else{
                    toastr.error('Validation Failed, Suite not saved! Check error messages!');
                    thisController.suiteView.showErrorDialog(data);
                }
            },
            'dataType': "json",
            'contentType': 'application/json; charset=UTF-8'
        });
        console.log("Ajax Request done");
    }

    /**
     * Make a call to the server to run the suite
     *
     * @param {String} suiteName - name of the suite
     * @memberof SuiteController
     */
    runSuite(suiteName) {
        console.log("Making get request")
        $.get("/run", "suiteName=" + suiteName, function (data) {
            console.log(data);
        });
    }

    /**
     * Get the JSON Model of the Suite
     *
     * @returns JSON mode of the suite
     * @memberof SuiteController
     */
    getSuiteJson() {
        return this.suiteModel.getJson();
    }


    // facade methods for shortcut keys binding
    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Saves the suite
     * @memberof SuiteController
     */
    save() {
        this.suiteView.doSaveAction(false);
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Creates a new script in the suite
     * @memberof SuiteController
     */
    newScript() {
        this.suiteView.clearNewScriptDialogFields();
        this.suiteView.showNewScriptDialog();
        $("#tb-script-name").focus();
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Creates a new suite, provides a warning that the current suite will be overwritten.
     * @memberof SuiteController
     */
    newSuite() {
        this.suiteView.showSuiteOverwriteWarning(true);
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Exports the current suite as a json file
     * @memberof SuiteController
     */
    export() {
        this.suiteView.doSaveAction(false);
        this.suiteView.downloadSuite();
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Runs the current suite
     * @memberof SuiteController
     */
    run() {
        this.suiteView.doSaveAction(true);
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Shows the file open dialog for choose the script to be loaded
     * @memberof SuiteController
     */
    load() {
        this.suiteView.showSuiteOverwriteWarning(true);
    }

    /**
     * A facade method for shortcut key bindings &lt;br/>
     * Shows the settings dialog
     * @memberof SuiteController
     */
    settings() {
        // load the settings into the fields and show
        this.suiteView.displaySettings(false);
    }

    /**
     * Closes the current suite before creating a new suite or load another suite
     *
     * @memberof SuiteController
     */
    closeSuite() {
        const scripts = this.suiteModel.scripts;
        for (let i = 0; i &lt; scripts.length; ++i) {
            this.suiteView.removeScriptAndTab(scripts[i].name, 0);
        }
        this.suiteModel.initialize();
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon Jun 01 2020 01:34:52 GMT+0530 (India Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
